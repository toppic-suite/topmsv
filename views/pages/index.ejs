<!DOCTYPE html>
<html lang="en">
<head>
	<% include ../partials/head %>
	<script
			src="https://code.jquery.com/jquery-3.4.1.min.js"
			integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
			crossorigin="anonymous"></script>
	<script
			src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"
			integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU="
			crossorigin="anonymous"></script>

	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

	<!-- Optional theme -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

	<!-- Latest compiled and minified JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

	<link rel="stylesheet" href="css/jquery-ui.min.css">
	<link href="css/styles.css" type="text/css" rel="stylesheet" />
	<link rel="stylesheet" href="css/jquery.fileupload.css">

	<script src="https://d3js.org/d3.v5.min.js"></script>
	<script src="js/spectrum_graph/invokespectrum.js" ></script>
	<script src="js/spectrum_graph/spectrumparameters.js" ></script>
	<script src="js/spectrum_graph/spectrumgraph.js" ></script>
	<script src="js/spectrum_graph/spectrumdownload.js" ></script>

	<script src="js/download/FileSaver.js"></script>
	<script src="js/download/saveImage.js"></script>

	<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.20/css/jquery.dataTables.css">
	<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.js"></script>
	<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/1.6.1/js/dataTables.buttons.min.js"></script>
	<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/1.6.1/js/buttons.flash.min.js"></script>
	<script type="text/javascript" charset="utf8" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
	<script type="text/javascript" charset="utf8" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
	<script type="text/javascript" charset="utf8" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
	<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/1.6.1/js/buttons.html5.min.js"></script>
	<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/buttons/1.6.1/js/buttons.print.min.js"></script>
	<script type="text/javascript" src="https://cdn.datatables.net/select/1.3.1/js/dataTables.select.min.js"></script>
</head>
<body class="container">

	<main>
		<!-- Modal -->
		<div id="msalignModal" class="modal fade" role="dialog">
			<div class="modal-dialog">

				<!-- Modal content-->
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal">&times;</button>
						<h4 class="modal-title">Msalign files</h4>
					</div>
					<div class="modal-body">
						<p>
							If you want to delete current existing msalign file for envelope peaks, please click the button below.
						</p>
						<button class="btn" id="deleteMsalign">Delete existing msalign</button>
						<br>
						<p>If you want to upload new msalign files for envelope peaks, please upload both MS1 msalign file and MS2 msalign file below.
							Once you upload files successfully, please wait our server to process data. When everything is done, we will send an email to you.</p>
						<label for="MS1_msalign">MS1 msalign file</label>
						<input class="form-control-file" type="file" id="MS1_msalign">
						<br>
						<label for="MS2_msalign">MS2 msalign file</label>
						<input class="form-control-file" type="file" id="MS2_msalign">
						<br>
						<table>
							<tr>
								<td><button class="btn" id="modalUpload">Upload</button></td>
								<td width="40pt"></td>
								<td style="width: 300pt">
									<div id="dbprogress" class="progress">
										<div id="progressbar" class="progress-bar progress-bar-striped" role="progressbar"
											 style="width: 0%">0%</div>
									</div>
								</td>
							</tr>
						</table>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
					</div>
				</div>
			</div>
		</div>
		<!-- Sequence Modal -->
		<div id="seqModal" class="modal fade" role="dialog">
			<div class="modal-dialog">

				<!-- Modal content-->
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal">&times;</button>
						<h4 class="modal-title">Upload sequence file</h4>
					</div>
					<div class="modal-body">
						<label for="sequenceFile">Sequence file</label>
						<input class="form-control-file" type="file" id="seqFile">
						<br>
						<table>
							<tr>
								<td><button class="btn" id="seqUpload">Upload</button></td>
								<td width="40pt"></td>
								<td style="width: 300pt">
									<div id="seqProgress" class="progress">
										<div id="seqProgressbar" class="progress-bar progress-bar-striped" role="progressbar"
											 style="width: 0%">0%</div>
									</div>
								</td>
							</tr>
						</table>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
					</div>
				</div>
			</div>
		</div>
		<div class="jumbotron">
			<div>
				<span class="projectsummary">
					<div class="row">
						<div class="projectName col-sm-9">
						<strong>Project Name:</strong> <%= summary.ProjectName %>
						</div>
						<div class="col-sm-3">
							<div class="row">
								<div class="col-sm-4">
								<button id="home" class="btn" onclick="window.location.href = '/';">Home</button>
								</div>
								<div class="col-sm-4">
									<button id="uploadMsalign" type="button" class="btn" data-toggle="modal" data-target="#msalignModal">Msalign</button>
								</div>
								<div class="col-sm-4">
									<button id="uploadSequence" type="button" class="btn" data-toggle="modal" data-target="#seqModal">Sequence</button>
								</div>
							</div>
						</div>
					</div>
					<div class="row">
						<div class="fileName col-sm-6">
							<strong>mzML File:</strong> <a href="/download?id=<%= projectCode %>" download><%= fileName %></a>
						</div>
						<div class="ms1EnvFile col-sm-6" id="envFileInfo">
							<strong>Envelope File:</strong> <span id="envelopeFile"><%= summary.MS1_envelope_file %></span>
						</div>
					</div>
				</span>
			</div>

			<hr>

			<div id="input">
				<div class="scanleveltitle row">
					<div class="col-sm-9">
						<strong>Scan Range:<%= scanRange.MIN %> - <%= scanRange.MAX %></strong>
					</div>
					<div class="col-sm-3">
						<div class="row">
							<div class="col-sm-4">
								<label for="scanID" id="scanRange">Scan:</label>
							</div>
							<div class="col-sm-4">
								<input type="text" id="scanID" name="scanID" min=<%= scanRange.MIN %> max=<%= scanRange.MAX %>>
							</div>
							<div class="col-sm-4">
								<button class="btn" type="submit" id="request">Request</button>
							</div>
						</div>
					</div>
				</div>

				<div class="scanleveltitle row">
					<div class="col-sm-4">
						<div class="row">
							<div class="col-sm-3">
								RT:<span id="rt-hover">0</span>
							</div>
							<div class="col-sm-6">
								<div id="shiftRight">
									Intensity:<span id="intensity-hover">0</span>
								</div>
							</div>
							<div class="col-sm-3">
								Scan:<span id="scan-hover">0</span>
							</div>
						</div>
					</div>
				</div>

				<input type="hidden" id="projectCode" name="projectCode" value="<%= projectCode %>">
				<input type="hidden" id="projectDir" name="projectDir" value="<%= projectDir %>">
				<input type="hidden" id="rangeMin" value=<%= scanRange.MIN %>>
				<input type="hidden" id="rangeMax" value=<%= scanRange.MAX %>>
				<input type="hidden" id="envStatus" value=<%= summary.envStatus %>>
				<input type="hidden" id="projectName" value=<%= summary.ProjectName %>>
				<input type="hidden" id="email" value=<%= summary.EmailAddress %>>

			</div>
			<div class="row">
				<div id="rt-sum" class="col-sm-12">
				</div>
			</div>

			<hr>
			<div id="scanLevelOne">
				<p class="scanleveltitle">
					<div class="flex-column">
						<b>Scan Level 1</b>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
						<span id="scanid1">
							Scan:
							<span id="scanID1"></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
							Retention Time: <span id="scan1RT"></span>
						</span>
					</div>
					<div class="flex-column">
						<button class="btn" type="submit" id="prev1">Previous</button>
						<button class="btn" type="submit" id="next1">Next</button>
					</div>
				</p>
				<svg id="spectrum1"></svg><br />
			</div>
			<hr>
			<div id="scanLevelTwo">
				<p class="scanleveltitle" id="scanLevelTwoInfo">
					<b>Scan Level 2</b>&nbsp;&nbsp;&nbsp;&nbsp;
					Scan:<span id="scanID2"></span>&nbsp;&nbsp;&nbsp;&nbsp;
					Precursor MZ:<span id="prec_mz"></span>&nbsp;&nbsp;&nbsp;&nbsp;
					Precursor Charge:<span id="prec_charge"></span>&nbsp;&nbsp;&nbsp;&nbsp;
					Precursor Intensity:<span id="prec_inte"></span>&nbsp;&nbsp;&nbsp;&nbsp;
					Retention Time:<span id="rt"></span>
				</p>
				<p class="scanleveltitle">
					<span id = "noScanLevelTwo"><strong>No Scan Level 2</strong></span>
				</p>
				<div id="tabs">
					<ul id="tabList">
					</ul>
					<svg id="spectrum2"></svg>
				</div>
			</div>
			<br>
			<hr>
			<div id="envInfo">
				<p class="scanleveltitle" id="scanLevelTwoInfo">
					<b>Envelope Table</b>&nbsp;&nbsp;&nbsp;&nbsp;
					<span id="msType"></span> Scan: <span id="envScan"></span>
				<div>
					Proteoform: <span id="proteoform"></span>
				</div>
				</p>
				<div>
					<button class="btn" id="inspect">Inspect</button>
					<button class="btn" id="switch">MS1</button>
					<button class="btn" id="hide">Hide</button>
				</div>

				<div id="datatable">
				<table id="envTable" class="display" style="width:100%">
					<thead>
					<tr>
						<th>Envelope ID</th>
						<th>Scan</th>
						<th>Charge</th>
						<th>Mono Mass</th>
						<th>Intensity</th>
						<th>Mono M/Z</th>
					</tr>
					</thead>
					<!--<tfoot>
					<tr>
						<th>Scan</th>
						<th>Charge</th>
						<th>Theo Mono Mass</th>
						<th>Mono M/Z</th>
					</tr>
					</tfoot>-->
				</table>
				</div>
			</div>
		</div>
	</main>
	<script type="text/javascript" src="js/dataVisualization.js"></script>
	<script src="js/dataTables.altEditor.free.js"></script>
</body>
</html>