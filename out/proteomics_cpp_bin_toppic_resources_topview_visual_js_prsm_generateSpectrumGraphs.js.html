<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: proteomics_cpp/bin/toppic_resources/topview/visual/js/prsm/generateSpectrumGraphs.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: proteomics_cpp/bin/toppic_resources/topview/visual/js/prsm/generateSpectrumGraphs.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Available functions in the file are 
 *      {generateCorrespondingGraph}, {graphOnClickActions}
 * Generating multiple graphs with different scan Id.
 * 1.   Once the data is loaded from local files from the function {promiseLoadDataJS} from multiscan.js,
 *      it sets the data into global variables ms2_ScansWithData and ms1_ScansWithData.
 * 2.   Once the data is set to the global variables, then it creates navigation elements by calling 
 *      {createMs1NavEements}, {createMs2NavEements}. 
 * 3.   Once navigation elements are generated, {graphOnClickActions} function is called to set the 
 *      on click actions on the navigation buttons of the spectrum graph
 */
function svgIds()
{
    this.ms2SvgId = "ms2svg_";
    this.ms2popUpSvgId = "ms2svg_popup_";
    return this;
}
function generateCorrespondingGraph(current_data,id,prec_mz,specId){
    let startOfId = id.split("_")[0];
    let graphFeatures = new GraphFeatures();
    if(startOfId == "monoMassSvg")
    {
        let calculatePrefixAndSuffixMassObj = new CalculatePrefixAndSuffixMass();
        let massShift_in = calculatePrefixAndSuffixMassObj.getIonTypeMass("B");
        let seq = calculatePrefixAndSuffixMassObj.getSequence(prsm_data);
        let massShiftList = calculatePrefixAndSuffixMassObj.getUnknownMassList();
        let prefixMassList = calculatePrefixAndSuffixMassObj.getPrefixMassList(seq,massShiftList,massShift_in);
        massShift_in = calculatePrefixAndSuffixMassObj.getIonTypeMass("Y");
        let suffixMassList = calculatePrefixAndSuffixMassObj.getSuffixMassList(seq,massShiftList,massShift_in);
        graphFeatures.showSequene = true;
        graphFeatures.prefixSequenceData = prefixMassList;
        graphFeatures.suffixSequeceData = suffixMassList;
        graphFeatures.svgHeight = graphFeatures.svgHeight+graphFeatures.adjustableHeightVal;
        graphFeatures.padding.head = graphFeatures.padding.head + graphFeatures.adjustableHeightVal;
        graphFeatures.adjustableIonPosition = 10;
        // Current Data itself contains Peak data
        spectrumgraph = new addSpectrum(id, current_data, null, prec_mz, current_data,graphFeatures);
    }   
    else{
        let peak_data = new PeakData();
        let peak_list = peak_data.getPeakData(current_data);
        let envelope_list = peak_data.getEnvelopeData(current_data);
        if(id != "popupspectrum")
        {
            let ionData = peak_data.getIonData(prsm_data,specId,current_data);
            ms2_graph = new addSpectrum(id, peak_list, envelope_list, prec_mz, ionData, graphFeatures);
        }
        else{
            graphFeatures.isAddbgColor = true;
            let precursor_mass = prsm_data.prsm.ms.ms_header.precursor_mono_mass;
            graphFeatures.bgMinMz = (graphFeatures.ratio * prec_mz) - graphFeatures.fixedWidthOfBgColorForMs1;
            graphFeatures.bgMaxMz = (graphFeatures.ratio * prec_mz) + graphFeatures.fixedWidthOfBgColorForMs1;
            spectrumgraph = new addSpectrum(id, peak_list, envelope_list, prec_mz, null,graphFeatures);
        }
    }
}
function getMinMzFromSpectrumData(envelope_list,precursor_mass)
{ 
    let env_peaks = [];
    let minMz = 0;
    let maxMz = 0;
    envelope_list.forEach((element)=>{
        if(parseFloat(element.mono_mass).toFixed(3) == parseFloat(precursor_mass).toFixed(3))
        {
            env_peaks = element.env_peaks;
        }
    });
    if(env_peaks.length != 0)
    {
        env_peaks.sort(function(a, b){
            return a.mz-b.mz;
        })
    }
    minMz = env_peaks[0].mz;
    maxMz = env_peaks[env_peaks.length-1].mz;
    return[minMz,maxMz];
}
function reDrawWithSpecParams(current_data,id,spectrumParameters,specId)
{
    let peak_data = new PeakData();
    let peak_list = peak_data.getPeakData(current_data);
    let envelope_list = peak_data.getEnvelopeData(current_data);
    let ionData = peak_data.getIonData(prsm_data,specId,current_data);
    peak_list.sort(function(x,y){
		return d3.descending(x.intensity, y.intensity);
	})
    envelope_list = sortEnvelopes(envelope_list) ;
    let svgId = "#"+id;
    let peakData = {peak_list:peak_list, envelope_list:envelope_list};
    let graphFeatures = new GraphFeatures();
    new SpectrumGraph(svgId,spectrumParameters,peakData, ionData,graphFeatures);
}
function createMultipleSvgs(divId,svgId,className,current_data){
    let div = document.getElementById(divId); 
    current_data.forEach(function(element,i){
        let id = svgId+element.scanId;
        let svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");;
        svg.setAttribute("id",id);
        svg.setAttribute("class",className);
        svg.style.backgroundColor = "#F8F8F8"; 
        if(i != 0)
        {
            svg.style.display = "none"; 
        }
        div.appendChild(svg);
        generateCorrespondingGraph(element.value,id,null,element.specId);
    });
}

function createMultiplePopUpSvgs(current_data)
{
    let div = document.getElementById("ms2_graph_popup_nav_div"); 
    current_data.forEach(function(element,i){
        let id = "ms2svg_popup_"+element.scanId;
        let svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");;
        svg.setAttribute("id",id);
        svg.setAttribute("class","ms2_svg_graph_popup_class");
        svg.style.backgroundColor = "#F8F8F8"; 
        if(i != 0)
        {
            svg.style.display = "none"; 
        }
        div.appendChild(svg);
        generateCorrespondingGraph(element.value,id,null,element.specId);
    });
}
function createDummySpecParamsList(current_data){
    let spectrumParams_global = [];
    let specParams = {};
    let tempSpecParams = {};
    current_data.forEach(function(element,i){
        tempSpecParams = {"scanId":element.scanId,"specParams":specParams};
        spectrumParams_global.push(tempSpecParams);
    })
    return spectrumParams_global;
}
function showCorrespondingGraph(id,className)
{
    $(className).hide();
    document.getElementById(id).style = "block";
}
function graphOnClickActions(){

    $("#graph_download").click(function(){
        let currentGraphNode = $('.ms2_scanIds.active')[0].text;
        let scanId = currentGraphNode.split(" ")[1];
		let [current_data,specId] = getCurrentData(ms2_ScansWithData,scanId);
        let id = "ms2svg_"+scanId;
        let specparams = jQuery.extend(true, {}, correspondingSpecParams_g[id]);//correspondingSpecParams_g[id];
        let graphFeatures = new GraphFeatures();
        document.getElementsByName("show_envelops")[0].checked = graphFeatures.showCircles;
        document.getElementsByName("show_ions")[0].checked = graphFeatures.showIons;
        reDrawWithSpecParams(current_data,"popup_ms2_spectrum",specparams,specId);
		$("#ms2spectrumpop").draggable({
			appendTo: "body"
		});
    })

    //ms2_scanIds is the Id of the nav tabs for multiple navs
	$(".ms2_scanIds").click(function(){
        let value = this.getAttribute('value');
        let [currentData,specId] = getCurrentData(ms2_ScansWithData,value);
        id = "ms2svg_"+value;
        showCorrespondingGraph(id,".ms2_svg_graph_class");
		$("#ms2_graph_nav .active").removeClass("active");
   		$(this).addClass("active");
	})
	
    $(".monoMass_scanIds").click(function(){
		let value = this.getAttribute('value');
        let [currentData,specId] = getCurrentData(monoMassDataList,value);
        id = "monoMassSvg_"+value;
        showCorrespondingGraph(id,".monoMass_svg_graph_class");
		//generateCorrespondingGraph(currentData,"monoMassSvg_",null,specId);
		$("#monoMass_nav .active").removeClass("active");
   		$(this).addClass("active");
    })
    
    $(".peakRows").click(function() {
		let parent_id  = $(this).parent().parent().prop('id');
		let CurrentScanVal = document.getElementById(parent_id).firstChild.innerHTML;
		/*	get Mono M/z value till 3 decimal values	*/
		let peak_value = parseFloat(this.innerHTML).toFixed(3) ;
		let [currentData,specId] = getCurrentData(ms2_ScansWithData,CurrentScanVal);
        let id = "ms2svg_"+CurrentScanVal;
        showCorrespondingGraph(id,".ms2_svg_graph_class");
        generateCorrespondingGraph(currentData,id,peak_value,specId);
        id = "monoMassSvg_"+CurrentScanVal;
        showCorrespondingGraph(id,".monoMass_svg_graph_class");
        [currentData,specId] = getCurrentData(monoMassDataList,CurrentScanVal);
        let CurrentMonoMassVal = $("#"+parent_id+" .row_monoMass").html();
        generateCorrespondingGraph(currentData,id,parseFloat(CurrentMonoMassVal),specId);
        activateCurrentnavbar("ms2_graph_nav",CurrentScanVal);
        activateCurrentnavbar("monoMass_nav",CurrentScanVal);
        
		showSpectrun();
    });

    $("#ms2_popup_redraw").click(function(){
        let currentGraphNode = $('.ms2_scanIds.active')[0].text;
        let scanId = currentGraphNode.split(" ")[1];
		let [current_data,specId] = getCurrentData(ms2_ScansWithData,scanId);
        let id = "popup_ms2_spectrum";
        //Copying as a new variable than referencing. Referencing will change the properties of parent if child properties are changes
        //However, this is a shallow copying, we need to do this for all needed objects in side specparams
        let specparams = jQuery.extend(true, {}, correspondingSpecParams_g[id]);
        specparams.graphFeatures = jQuery.extend(true, {}, correspondingSpecParams_g[id].graphFeatures);
        specparams.graphFeatures.showCircles = document.getElementsByName("show_envelops")[0].checked ;
        specparams.graphFeatures.showIons = document.getElementsByName("show_ions")[0].checked ;
        reDrawWithSpecParams(current_data,"popup_ms2_spectrum",specparams,specId);
    })
    
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Namespaces</h3><ul><li><a href="-_anonymous_-altEditor.classes.html">classes</a></li><li><a href="-_anonymous_-altEditor.defaults.html">defaults</a></li><li><a href="-_ext.type.html">type</a></li><li><a href="Common%2520and%2520useful%2520DOM%2520elements%2520for%2520the%2520class%2520instance.html">Common and useful DOM elements for the class instance</a></li><li><a href="DataTable.defaults.html">defaults</a></li><li><a href="DataTable.defaults.classes.html">classes</a></li><li><a href="DataTable.defaults.html#.column">column</a></li><li><a href="DataTable.defaults.language.html">language</a></li><li><a href="DataTable.defaults.language.aria.html">aria</a></li><li><a href="DataTable.defaults.language.paginate.html">paginate</a></li><li><a href="DataTable.defaults.search.html">search</a></li><li><a href="DataTable.ext.html">ext</a></li><li><a href="DataTable.models.html">models</a></li><li><a href="DataTable.models.oColumn.html">oColumn</a></li><li><a href="DataTable.models.oRow.html">oRow</a></li><li><a href="DataTable.models.oSearch.html">oSearch</a></li><li><a href="DataTable.models.oSettings.html">oSettings</a></li><li><a href="DataTable.models.oSettings.oBrowser.html">oBrowser</a></li><li><a href="DataTable.models.oSettings.oFeatures.html">oFeatures</a></li><li><a href="DataTable.models.oSettings.oLanguage.html">oLanguage</a></li><li><a href="DataTable.models.oSettings.oPreviousSearch.html">oPreviousSearch</a></li><li><a href="DataTable.models.oSettings.oScroll.html">oScroll</a></li><li><a href="DataTable.render.html">render</a></li><li><a href="DataTable.util.html">util</a></li><li><a href="Settings%2520object%2520which%2520contains%2520customisable%2520information%250A%2520%2520%2520%2520%2520%2520%2520%2520%2520%2520%2520for%2520altEditor%2520instance.html">Settings object which contains customisable information
           for altEditor instance</a></li></ul><h3>Classes</h3><ul><li><a href="CalculateEmassAndDistribution.html">CalculateEmassAndDistribution</a></li><li><a href="Constants.html">Constants</a></li><li><a href="DataTable.Api.html">Api</a></li><li><a href="GetMassTableOfSelectedIons.html">GetMassTableOfSelectedIons</a></li><li><a href="MolecularFormulae.html">MolecularFormulae</a></li><li><a href="SpectrumDownload.html">SpectrumDownload</a></li><li><a href="DataTable_.html">~DataTable</a></li></ul><h3>Events</h3><ul><li><a href="DataTable_column-sizing.html#.event:dt">dt</a></li><li><a href="DataTable_column-visibility.html#.event:dt">dt</a></li><li><a href="DataTable_destroy.html#.event:dt">dt</a></li><li><a href="DataTable_draw.html#.event:dt">dt</a></li><li><a href="DataTable_init.html#.event:dt">dt</a></li><li><a href="DataTable_length.html#.event:dt">dt</a></li><li><a href="DataTable_order.html#.event:dt">dt</a></li><li><a href="DataTable_page.html#.event:dt">dt</a></li><li><a href="DataTable_processing.html#.event:dt">dt</a></li><li><a href="DataTable_search.html#.event:dt">dt</a></li><li><a href="DataTable_stateLoaded.html#.event:dt">dt</a></li><li><a href="DataTable_stateLoadParams.html#.event:dt">dt</a></li><li><a href="DataTable_stateSaveParams.html#.event:dt">dt</a></li><li><a href="DataTable_xhr.html#.event:dt">dt</a></li></ul><h3>Global</h3><ul><li><a href="global.html#$">$</a></li><li><a href="global.html#_">_</a></li><li><a href="global.html#_addRowCallback">_addRowCallback</a></li><li><a href="global.html#_addRowData">_addRowData</a></li><li><a href="global.html#_deleteRow">_deleteRow</a></li><li><a href="global.html#_deleteRowCallback">_deleteRowCallback</a></li><li><a href="global.html#_editRowCallback">_editRowCallback</a></li><li><a href="global.html#_editRowData">_editRowData</a></li><li><a href="global.html#_errorCallback">_errorCallback</a></li><li><a href="global.html#addBackGround">addBackGround</a></li><li><a href="global.html#addCircles">addCircles</a></li><li><a href="global.html#addDatatoAxis">addDatatoAxis</a></li><li><a href="global.html#addLabels">addLabels</a></li><li><a href="global.html#addSpectrum">addSpectrum</a></li><li><a href="global.html#api">api</a></li><li><a href="global.html#calibrateCoordinates">calibrateCoordinates</a></li><li><a href="global.html#calibrateLeftNum">calibrateLeftNum</a></li><li><a href="global.html#calibrateRightNum">calibrateRightNum</a></li><li><a href="global.html#calibrateSkipEnd">calibrateSkipEnd</a></li><li><a href="global.html#calibrateSkipStart">calibrateSkipStart</a></li><li><a href="global.html#checkWaitTasks">checkWaitTasks</a></li><li><a href="global.html#completeColumnDefs">completeColumnDefs</a></li><li><a href="global.html#createDialog">createDialog</a></li><li><a href="global.html#drag">drag</a></li><li><a href="global.html#drawAxis">drawAxis</a></li><li><a href="global.html#drawIons">drawIons</a></li><li><a href="global.html#drawPeaks">drawPeaks</a></li><li><a href="global.html#drawSequence">drawSequence</a></li><li><a href="global.html#drawSpectrum">drawSpectrum</a></li><li><a href="global.html#drawTicks">drawTicks</a></li><li><a href="global.html">Edit a row</a></li><li><a href="global.html#fnAddData">fnAddData</a></li><li><a href="global.html#fnAdjustColumnSizing">fnAdjustColumnSizing</a></li><li><a href="global.html#fnClearTable">fnClearTable</a></li><li><a href="global.html#fnClose">fnClose</a></li><li><a href="global.html#fnDeleteRow">fnDeleteRow</a></li><li><a href="global.html#fnDestroy">fnDestroy</a></li><li><a href="global.html#fnDraw">fnDraw</a></li><li><a href="global.html#fnFilter">fnFilter</a></li><li><a href="global.html#fnGetData">fnGetData</a></li><li><a href="global.html#fnGetNodes">fnGetNodes</a></li><li><a href="global.html#fnGetPosition">fnGetPosition</a></li><li><a href="global.html#fnIsOpen">fnIsOpen</a></li><li><a href="global.html#fnOpen">fnOpen</a></li><li><a href="global.html#fnPageChange">fnPageChange</a></li><li><a href="global.html#fnSetColumnVis">fnSetColumnVis</a></li><li><a href="global.html#fnSettings">fnSettings</a></li><li><a href="global.html#fnSort">fnSort</a></li><li><a href="global.html#fnSortListener">fnSortListener</a></li><li><a href="global.html#fnUpdate">fnUpdate</a></li><li><a href="global.html#fnVersionCheck">fnVersionCheck</a></li><li><a href="global.html#getAminoAcidDistribution">getAminoAcidDistribution</a></li><li><a href="global.html#getCircleSize">getCircleSize</a></li><li><a href="global.html#getEnvelopeData">getEnvelopeData</a></li><li><a href="global.html#getIonData">getIonData</a></li><li><a href="global.html#getIsotopicMassOfAtom">getIsotopicMassOfAtom</a></li><li><a href="global.html#getIsotopicMassRef">getIsotopicMassRef</a></li><li><a href="global.html#getNormalizedIntensity">getNormalizedIntensity</a></li><li><a href="global.html#getPeakXPos">getPeakXPos</a></li><li><a href="global.html#getPeakYPos">getPeakYPos</a></li><li><a href="global.html#getTickHeight">getTickHeight</a></li><li><a href="global.html#getTickWidth">getTickWidth</a></li><li><a href="global.html#getY">getY</a></li><li><a href="global.html#groupBy">groupBy</a></li><li><a href="global.html#initScale">initScale</a></li><li><a href="global.html#job">job</a></li><li><a href="global.html#onAddRow">onAddRow</a></li><li><a href="global.html#onCircleMouseOut">onCircleMouseOut</a></li><li><a href="global.html#onclickTopView">onclickTopView</a></li><li><a href="global.html#onDeleteRow">onDeleteRow</a></li><li><a href="global.html#onDragLimits">onDragLimits</a></li><li><a href="global.html#onEditRow">onEditRow</a></li><li><a href="global.html#onMouseOut">onMouseOut</a></li><li><a href="global.html#onMouseOverCircle">onMouseOverCircle</a></li><li><a href="global.html#onMouseOverPeak">onMouseOverPeak</a></li><li><a href="global.html#onPeakMouseOut">onPeakMouseOut</a></li><li><a href="global.html#parameters">parameters</a></li><li><a href="global.html#reloadOptions">reloadOptions</a></li><li><a href="global.html#setLimits">setLimits</a></li><li><a href="global.html#showAllPeaks">showAllPeaks</a></li><li><a href="global.html#showIonPeaks">showIonPeaks</a></li><li><a href="global.html#showMatchedPeaks">showMatchedPeaks</a></li><li><a href="global.html#showNonMatchedPeaks">showNonMatchedPeaks</a></li><li><a href="global.html#showNotMatchedPeaks">showNotMatchedPeaks</a></li><li><a href="global.html#sortEnvelopes">sortEnvelopes</a></li><li><a href="global.html#SpectrumGraph">SpectrumGraph</a></li><li><a href="global.html#svgIds">svgIds</a></li><li><a href="global.html#updateSeq">updateSeq</a></li><li><a href="global.html#xZoom">xZoom</a></li><li><a href="global.html#yZoom">yZoom</a></li><li><a href="global.html#zoom">zoom</a></li><li><a href="global.html#%257BonClickSequenceOfExecution%257Dexecuteswhenuserentersmassshiftonanyaminoacidandclick%2522OK%2522button.">{onClickSequenceOfExecution} executes when user enters mass shift 
on any amino acid and click "OK" button.</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.4</a> on Thu Apr 16 2020 16:10:17 GMT-0400 (Eastern Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
