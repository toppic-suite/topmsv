<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: proteomics_cpp/bin/toppic_resources/topview/inspect/js/mass_shift/massshift.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: proteomics_cpp/bin/toppic_resources/topview/inspect/js/mass_shift/massshift.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>class MassShifts {
	constructor(){
		this.SEQUENCEDATA_ID = "#sequencedata";
	}
	/**
	 * Get the sequence entered from the HTML.
	 */
	getSequenceFromUI(){
		var seq = $(this.SEQUENCEDATA_ID).val().trim();
		seq = seq.toUpperCase();//set the sequence to be upper case automatically -- for user convenience
		
		let massShiftList = [] ;
		[seq,massShiftList]= this.getMassShiftList(seq);
		/**
		 * Remove spaces if exists between sequences
		 */
		seq = seq.replace(/ +/g, "");
		return [seq,massShiftList] ;
	}
	/**
	 * @param {string} seq - an argument with mass shift changes embeded
	 * in [] square bracket.
	 * @return {string,Array} parsedseq - sequence after removing the mass
	 * Shifts. Array with {position,mass} position-position at which 
	 * mass shift occured, mass- mass shift value.
	 */
	getMassShiftList(seq){
		let massShiftList = [] ;
		let parsedseq = "";
		let splitStr = seq.split(/\[(.*?)\]/);
		let splitArraylen = splitStr.length;
		let position = 0 ;
		
		for(let i = 0 ; i&lt;splitArraylen;i++)
		{
			if(isNaN(splitStr[i]))
			{
				parsedseq = parsedseq + splitStr[i] ;
				position = position + splitStr[i].length ;
			}
			else
			{
				let mass = parseFloat(splitStr[i]);
				/**
				 * remove 1 as the data starts from 0 and length starts from 1
				 */
				let tempPosition = position - 1;
				//Initially set the bg_color to null
				let shiftobj = {mass:mass,position:tempPosition,bg_color:null};
				/**
				 * when the split occur at the end we get an extra "" in 
				 * the list. This is to check if the mass is numeric.
				 */
				if(!isNaN(mass))
				{
					massShiftList.push(shiftobj);
				}
			}
		}
		return [parsedseq,massShiftList] ;
	}
	/**
	 * @param {integer} shiftPosition - contains the position of the new mass
	 * shift entered in text box on click of any amino acid.
	 * @param {integer} massShiftVal - contains value of the mass entered.
	 * @param {Array} massShiftList - contains list of all existing mass 
	 * shifts with positions.
	 * @return{Array} with the new mass Shift value and position entered
	 * or changes the existing mass shift value.
	 */
	appendtoMassShiftList(shiftPosition,massShiftVal,massShiftList,bg_color){
		let newMassShiftList = [];
		let len = massShiftList.length;
		let matchFound = false ;
		for(let i=0; i&lt;len;i++)
		{
			if(shiftPosition == massShiftList[i].position)
			{
				massShiftList[i].mass = massShiftVal;
				massShiftList[i].bg_color = bg_color;
				matchFound = true ;
			}
		}
		if(!matchFound)
		{
			let tempShiftObj = {mass:massShiftVal,position:shiftPosition,bg_color:bg_color};
			massShiftList.push(tempShiftObj);
			matchFound = false;
		}
		let newlen = massShiftList.length;
		for(let j=0; j&lt;newlen; j++)
		{
			if(massShiftList[j].mass != 0)
			{
				newMassShiftList.push(massShiftList[j]);
			}
		}
		return newMassShiftList ;
	}
	/**
	 * Get the fixed ptm mass list with position
	 * @param {string} seq - plain sequence entered by the user.
	 * @return {Array} - Returns an Array of fixed mass shift with positions.
	 */
	getFixedMassList(seq){
		let fixedShiftList = [];
		let fixedPtmAcid = null;
		let fixedPtmMass = null;
		let fixedMassShiftList = this.getFixedPtmChecklist();
		let fixedMassLen = fixedMassShiftList.length;
		for(let k=0; k&lt;fixedMassLen; k++)
		{
			fixedPtmAcid = fixedMassShiftList[k].acid;
			fixedPtmMass = fixedMassShiftList[k].mass;
			if( fixedPtmAcid != null &amp;&amp; fixedPtmMass != null)
			{
				let seqln = seq.length ;
				for(let i = 0 ; i&lt;seqln;i++)
				{
					if(seq[i] == fixedPtmAcid)
					{
						let tempObj = {position:i,mass:fixedPtmMass,bg_color:null}
						fixedShiftList.push(tempObj);
					}
				}
			}
		}
		return fixedShiftList ;
	}
	/**
	 * Remove the removed fixed mass from fixed mass list
	 * @param {string} sequence - sequence without mass shifts
	 * @param {Array} fixedMassShiftList - Fixed mass shift list
	 * @param {Char} removeAcid - mass to be removed of a specific Acid
	 */
	removeFixedMassList(sequence,fixedMassShiftList,removeAcid)
	{
		let newList  = [];
		let len = fixedMassShiftList.length;
		removeAcid = removeAcid.toUpperCase()
		for(let i=0;i&lt;len;i++)
		{
			let pos = fixedMassShiftList[i].position ;
			if(sequence[pos] != removeAcid)
			{
				newList.push(fixedMassShiftList[i]);
			}
		}
		return newList ;
	}
	/**
	 * This returns combined List of both Fixed and user entered mass shifts
	 * @param {Array} massShiftList - List of all the mass Shifts from sequence
	 * @param {Array} fixedMassShiftList - List of all selected fixed masses
	 * @returns {Array} combinedMassShiftList - List of combined lists by checking 
	 * over lapping posiitons
	 */
	getCombinedMassShiftList(massShiftList,fixedMassShiftList){
		let combinedMassShiftList = massShiftList;
		let fixedMasslen = fixedMassShiftList.length;
		let massShiftlen = massShiftList.length;
		
		for(let i=0; i&lt;fixedMasslen ; i++)
		{
			let matched = false;
			for(let j=0;j&lt;massShiftlen;j++)
			{
				/**
				 * Check if both has mass shift at common position and over ride the mass shift with fixed mass shift
				 */
				if(combinedMassShiftList[j].position == fixedMassShiftList[i].position)
				{
					combinedMassShiftList[j].mass = fixedMassShiftList[i].mass ;
					combinedMassShiftList[j].bg_color = fixedMassShiftList[i].bg_color ;
					matched = true;
					break;
				}
			}
			/**
			 * If no match found then copy to the new combined list
			 */
			if(!matched)
			{
				combinedMassShiftList.push(fixedMassShiftList[i]);
			}
		}
		
		return combinedMassShiftList ;
	}
	/**
	 * @return {Array} FixedPtmList - return all the selected fixed ptms with acid and mass
	 */
	getFixedPtmChecklist()
	{
		let FixedPtmList = [];
		let divs = $( ".fixedptms").get();
		$( ".fixedptms" ).each(function( index ) {
		  let acid = $( this ).find('#fixedptmacid').val().toUpperCase();
		  let mass = parseFloat($( this ).find('#fixedptmmass').val());
		  if(acid.length !=0  &amp;&amp; mass.length != 0 &amp;&amp; !isNaN(mass))
		  	{
				let tempfixedptm = {acid:acid,mass:mass}
				FixedPtmList.push(tempfixedptm);
			}
		});
		return FixedPtmList;
	}
	/**
	 * forms the seq with all the mass lists and selected fixed ptms
	 * @param {string} seq - sequence with only aminoacids and without mass lists embedded
	 * @param {Array} massShiftList - List with all the combined mass shifts
	 * @return {string} newSeq - sequence with mass shifts embedded in []
	 */
	formSequence(seq,massShiftList){
		let newSeq = seq;
		let len = massShiftList.length; 
		let seqLen = seq.length ;
		let count = 0;
		/**
		 * sorting the lists with position
		 */
		massShiftList.sort(function(x,y){
			return d3.ascending(x.position, y.position);
		})
		for(let i=0;i&lt;len;i++)
		{
			let newSeqlen = newSeq.length ;
			/**
			 * Dont show when the mass is 0 in the string
			 */
			if(massShiftList[i].mass != 0){
				if(i == 0)
				{
					/**
					 * Add +1 as we need to append the mass after the current position
					 */
					let tempPosition = massShiftList[i].position+1 ;
					newSeq = newSeq.slice(0, tempPosition) + "["+ massShiftList[i].mass + "]"+newSeq.slice(tempPosition, newSeqlen);
				}
				else
				{
					/**
					 * Form the mass between []
					 */
					let tempString = "["+massShiftList[i-1].mass+"]";
					count = count + tempString.length;
					/**
					 * add +1 as the position need to be added after 
					 * the position of the acid.
					 */
					let tempPosition = massShiftList[i].position + 1 + count ;
					newSeq = newSeq.slice(0, tempPosition) + "["+ massShiftList[i].mass + "]" + newSeq.slice(tempPosition, newSeqlen);
				}
			}
		}
		return newSeq ;
	}
	/**
	 * write the sequence with embedded mass in [] to the screen(sequence box)
	 * @param {string} seqToUI - sequence with mass shifts embedded in []
	 */
	writeSeqToTextBox(seqToUI){
		$(this.SEQUENCEDATA_ID).val(seqToUI);
	}

}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Namespaces</h3><ul><li><a href="-_anonymous_-altEditor.classes.html">classes</a></li><li><a href="-_anonymous_-altEditor.defaults.html">defaults</a></li><li><a href="-_ext.type.html">type</a></li><li><a href="Common%2520and%2520useful%2520DOM%2520elements%2520for%2520the%2520class%2520instance.html">Common and useful DOM elements for the class instance</a></li><li><a href="DataTable.defaults.html">defaults</a></li><li><a href="DataTable.defaults.classes.html">classes</a></li><li><a href="DataTable.defaults.html#.column">column</a></li><li><a href="DataTable.defaults.language.html">language</a></li><li><a href="DataTable.defaults.language.aria.html">aria</a></li><li><a href="DataTable.defaults.language.paginate.html">paginate</a></li><li><a href="DataTable.defaults.search.html">search</a></li><li><a href="DataTable.ext.html">ext</a></li><li><a href="DataTable.models.html">models</a></li><li><a href="DataTable.models.oColumn.html">oColumn</a></li><li><a href="DataTable.models.oRow.html">oRow</a></li><li><a href="DataTable.models.oSearch.html">oSearch</a></li><li><a href="DataTable.models.oSettings.html">oSettings</a></li><li><a href="DataTable.models.oSettings.oBrowser.html">oBrowser</a></li><li><a href="DataTable.models.oSettings.oFeatures.html">oFeatures</a></li><li><a href="DataTable.models.oSettings.oLanguage.html">oLanguage</a></li><li><a href="DataTable.models.oSettings.oPreviousSearch.html">oPreviousSearch</a></li><li><a href="DataTable.models.oSettings.oScroll.html">oScroll</a></li><li><a href="DataTable.render.html">render</a></li><li><a href="DataTable.util.html">util</a></li><li><a href="Settings%2520object%2520which%2520contains%2520customisable%2520information%250A%2520%2520%2520%2520%2520%2520%2520%2520%2520%2520%2520for%2520altEditor%2520instance.html">Settings object which contains customisable information
           for altEditor instance</a></li></ul><h3>Classes</h3><ul><li><a href="CalculateEmassAndDistribution.html">CalculateEmassAndDistribution</a></li><li><a href="Constants.html">Constants</a></li><li><a href="DataTable.Api.html">Api</a></li><li><a href="GetMassTableOfSelectedIons.html">GetMassTableOfSelectedIons</a></li><li><a href="MolecularFormulae.html">MolecularFormulae</a></li><li><a href="SpectrumDownload.html">SpectrumDownload</a></li><li><a href="DataTable_.html">~DataTable</a></li></ul><h3>Events</h3><ul><li><a href="DataTable_column-sizing.html#.event:dt">dt</a></li><li><a href="DataTable_column-visibility.html#.event:dt">dt</a></li><li><a href="DataTable_destroy.html#.event:dt">dt</a></li><li><a href="DataTable_draw.html#.event:dt">dt</a></li><li><a href="DataTable_init.html#.event:dt">dt</a></li><li><a href="DataTable_length.html#.event:dt">dt</a></li><li><a href="DataTable_order.html#.event:dt">dt</a></li><li><a href="DataTable_page.html#.event:dt">dt</a></li><li><a href="DataTable_processing.html#.event:dt">dt</a></li><li><a href="DataTable_search.html#.event:dt">dt</a></li><li><a href="DataTable_stateLoaded.html#.event:dt">dt</a></li><li><a href="DataTable_stateLoadParams.html#.event:dt">dt</a></li><li><a href="DataTable_stateSaveParams.html#.event:dt">dt</a></li><li><a href="DataTable_xhr.html#.event:dt">dt</a></li></ul><h3>Global</h3><ul><li><a href="global.html#$">$</a></li><li><a href="global.html#_">_</a></li><li><a href="global.html#_addRowCallback">_addRowCallback</a></li><li><a href="global.html#_addRowData">_addRowData</a></li><li><a href="global.html#_deleteRow">_deleteRow</a></li><li><a href="global.html#_deleteRowCallback">_deleteRowCallback</a></li><li><a href="global.html#_editRowCallback">_editRowCallback</a></li><li><a href="global.html#_editRowData">_editRowData</a></li><li><a href="global.html#_errorCallback">_errorCallback</a></li><li><a href="global.html#addBackGround">addBackGround</a></li><li><a href="global.html#addCircles">addCircles</a></li><li><a href="global.html#addDatatoAxis">addDatatoAxis</a></li><li><a href="global.html#addLabels">addLabels</a></li><li><a href="global.html#addSpectrum">addSpectrum</a></li><li><a href="global.html#api">api</a></li><li><a href="global.html#calibrateCoordinates">calibrateCoordinates</a></li><li><a href="global.html#calibrateLeftNum">calibrateLeftNum</a></li><li><a href="global.html#calibrateRightNum">calibrateRightNum</a></li><li><a href="global.html#calibrateSkipEnd">calibrateSkipEnd</a></li><li><a href="global.html#calibrateSkipStart">calibrateSkipStart</a></li><li><a href="global.html#checkWaitTasks">checkWaitTasks</a></li><li><a href="global.html#completeColumnDefs">completeColumnDefs</a></li><li><a href="global.html#createDialog">createDialog</a></li><li><a href="global.html#drag">drag</a></li><li><a href="global.html#drawAxis">drawAxis</a></li><li><a href="global.html#drawIons">drawIons</a></li><li><a href="global.html#drawPeaks">drawPeaks</a></li><li><a href="global.html#drawSequence">drawSequence</a></li><li><a href="global.html#drawSpectrum">drawSpectrum</a></li><li><a href="global.html#drawTicks">drawTicks</a></li><li><a href="global.html">Edit a row</a></li><li><a href="global.html#fnAddData">fnAddData</a></li><li><a href="global.html#fnAdjustColumnSizing">fnAdjustColumnSizing</a></li><li><a href="global.html#fnClearTable">fnClearTable</a></li><li><a href="global.html#fnClose">fnClose</a></li><li><a href="global.html#fnDeleteRow">fnDeleteRow</a></li><li><a href="global.html#fnDestroy">fnDestroy</a></li><li><a href="global.html#fnDraw">fnDraw</a></li><li><a href="global.html#fnFilter">fnFilter</a></li><li><a href="global.html#fnGetData">fnGetData</a></li><li><a href="global.html#fnGetNodes">fnGetNodes</a></li><li><a href="global.html#fnGetPosition">fnGetPosition</a></li><li><a href="global.html#fnIsOpen">fnIsOpen</a></li><li><a href="global.html#fnOpen">fnOpen</a></li><li><a href="global.html#fnPageChange">fnPageChange</a></li><li><a href="global.html#fnSetColumnVis">fnSetColumnVis</a></li><li><a href="global.html#fnSettings">fnSettings</a></li><li><a href="global.html#fnSort">fnSort</a></li><li><a href="global.html#fnSortListener">fnSortListener</a></li><li><a href="global.html#fnUpdate">fnUpdate</a></li><li><a href="global.html#fnVersionCheck">fnVersionCheck</a></li><li><a href="global.html#getAminoAcidDistribution">getAminoAcidDistribution</a></li><li><a href="global.html#getCircleSize">getCircleSize</a></li><li><a href="global.html#getEnvelopeData">getEnvelopeData</a></li><li><a href="global.html#getIonData">getIonData</a></li><li><a href="global.html#getIsotopicMassOfAtom">getIsotopicMassOfAtom</a></li><li><a href="global.html#getIsotopicMassRef">getIsotopicMassRef</a></li><li><a href="global.html#getNormalizedIntensity">getNormalizedIntensity</a></li><li><a href="global.html#getPeakXPos">getPeakXPos</a></li><li><a href="global.html#getPeakYPos">getPeakYPos</a></li><li><a href="global.html#getTickHeight">getTickHeight</a></li><li><a href="global.html#getTickWidth">getTickWidth</a></li><li><a href="global.html#getY">getY</a></li><li><a href="global.html#groupBy">groupBy</a></li><li><a href="global.html#initScale">initScale</a></li><li><a href="global.html#job">job</a></li><li><a href="global.html#onAddRow">onAddRow</a></li><li><a href="global.html#onCircleMouseOut">onCircleMouseOut</a></li><li><a href="global.html#onclickTopView">onclickTopView</a></li><li><a href="global.html#onDeleteRow">onDeleteRow</a></li><li><a href="global.html#onDragLimits">onDragLimits</a></li><li><a href="global.html#onEditRow">onEditRow</a></li><li><a href="global.html#onMouseOut">onMouseOut</a></li><li><a href="global.html#onMouseOverCircle">onMouseOverCircle</a></li><li><a href="global.html#onMouseOverPeak">onMouseOverPeak</a></li><li><a href="global.html#onPeakMouseOut">onPeakMouseOut</a></li><li><a href="global.html#parameters">parameters</a></li><li><a href="global.html#reloadOptions">reloadOptions</a></li><li><a href="global.html#setLimits">setLimits</a></li><li><a href="global.html#showAllPeaks">showAllPeaks</a></li><li><a href="global.html#showIonPeaks">showIonPeaks</a></li><li><a href="global.html#showMatchedPeaks">showMatchedPeaks</a></li><li><a href="global.html#showNonMatchedPeaks">showNonMatchedPeaks</a></li><li><a href="global.html#showNotMatchedPeaks">showNotMatchedPeaks</a></li><li><a href="global.html#sortEnvelopes">sortEnvelopes</a></li><li><a href="global.html#SpectrumGraph">SpectrumGraph</a></li><li><a href="global.html#svgIds">svgIds</a></li><li><a href="global.html#updateSeq">updateSeq</a></li><li><a href="global.html#xZoom">xZoom</a></li><li><a href="global.html#yZoom">yZoom</a></li><li><a href="global.html#zoom">zoom</a></li><li><a href="global.html#%257BonClickSequenceOfExecution%257Dexecuteswhenuserentersmassshiftonanyaminoacidandclick%2522OK%2522button.">{onClickSequenceOfExecution} executes when user enters mass shift 
on any amino acid and click "OK" button.</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.4</a> on Thu Apr 16 2020 16:10:17 GMT-0400 (Eastern Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
