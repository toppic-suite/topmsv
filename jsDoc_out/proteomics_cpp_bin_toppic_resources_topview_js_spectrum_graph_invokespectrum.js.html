<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: proteomics_cpp/bin/toppic_resources/topview/js/spectrum_graph/invokespectrum.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: proteomics_cpp/bin/toppic_resources/topview/js/spectrum_graph/invokespectrum.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Starting point of drawing spectrum graph
 * @param {String} id - gets the svg id of the graph 
 * @param {list} peakList - contains the list of data with mz and intensity used to draw lines on the graph 
 * @param {list} envelopeList - contains the list of data with actual mass, mz and intensity used to draw circles on graph
 * @param {float} monoMZ - Value to which tha graph as to point on click of mz value used to zoom the grpah to that location
 * @param {list} ionData - contains the list of data with mass and acid name
 * @param {object} graphFeatures - contains all the features needed for drawing the graphs
 */
addSpectrum = function(id,peakList,envelopeList,monoMZ, ionData, graphFeatures){
	let specParameters = compSpectrumParameters(peakList, envelopeList, monoMZ);
	specParameters.graphFeatures = graphFeatures;
	let peakData = {};
	peakData.peak_list = peakList ;
	if(envelopeList != null)
	{
		peakData.envelope_list = sortEnvelopes(envelopeList) ;
	}
	id = "#"+id;
	if(ionData == null)
	{
		specParameters.graphFeatures.showIons = false ;
	}
	else{
		ionData = groupBy(ionData,'ion');
	}
	specParameters.padding = graphFeatures.padding;
	specParameters.specWidth = graphFeatures.specWidth;
	specParameters.specHeight = graphFeatures.specHeight;
	specParameters.svgHeight = graphFeatures.svgHeight;
	specParameters.padding.head = graphFeatures.padding.head;
	let spectrumGraph = new SpectrumGraph(id,specParameters,peakData,ionData);
	return spectrumGraph;
}
 //  Function to set spectrum perameters based on the data
 function compSpectrumParameters(peakList, envelopeList, monoMZ){
	let ratio = 1; 
	let specParameters = new SpectrumParameters();
	// Sort by mz
	peakList.sort(function(x,y){
		return x.mz - y.mz;
	});
	let listSize = peakList.length;
	let minMzData = peakList[0].mz;
	let maxMzData = peakList[listSize-1].mz;
	// Sort by intensity
	peakList.sort(function(x,y){
		return x.intensity - y.intensity;
	});

	let maxEnvelope = -1;
	let minEnvelope = 1000000000; // A random onstant high value
	if(envelopeList != null)
	{
		ratio = 1.000684;
		envelopeList.forEach(function(element){
			element.env_peaks.forEach(function(e){
				if (e.intensity > maxEnvelope){
					maxEnvelope = e.intensity;
				}
				else if (e.intensity &lt; minEnvelope){
					minEnvelope = e.intensity;
				}
			})
		})
	}
	let maxIntensity = peakList[listSize-1].intensity;
	let minIntensity = peakList[0].intensity;
	let currminMz = minMzData ;
	let currmaxMz = maxMzData ;
	let currentMaxIntensity;
	if (maxIntensity > maxEnvelope) {
		currentMaxIntensity = maxIntensity;
	}
	else {
		currentMaxIntensity = maxEnvelope;
	}

	if(monoMZ != null)
	{
		//  Initializing with 1% of total intensity. If there exists no peaks in the 
		//  current range the intensity can't be 0 or nothing which will produce an 
		//  error in arithmatic calculations
		currentMaxIntensity = 0.01 * currentMaxIntensity ;
		monoMZ = monoMZ * ratio;
		currminMz = monoMZ - specParameters.onClickMassAdjacentRange ;
		currmaxMz = monoMZ + specParameters.onClickMassAdjacentRange ;
		for(let i = 0; i&lt;listSize ; i++)
		{
			if(peakList[i].mz > currminMz &amp;&amp; peakList[i].mz &lt; currmaxMz)
			{
				if(peakList[i].intensity > currentMaxIntensity)
				{
					currentMaxIntensity = peakList[i].intensity;
				}
			}
		}
	}

	//  for specParameters, going to pass whichever value between peak max and envelope max that is bigger
	if (maxIntensity &lt; maxEnvelope){
		maxIntensity = maxEnvelope;
	}
	if (minIntensity > minEnvelope){
		minIntensity = minEnvelope;
	}
	specParameters.initScale(currminMz,currmaxMz,maxIntensity,minIntensity,minMzData,maxMzData,currentMaxIntensity);

	// Code must be included to get top 200 intensities at any given time
	peakList.sort(function(x,y){
		return d3.descending(x.intensity, y.intensity);
	});
	return specParameters;
 }

/**
 * Sorting envelopes based on intensity to show top 200 envelops with high intensitites
 */
sortEnvelopes = function(envelopeList)
{
	envelopeList.forEach(function(envelope){
		// ...env_peak converts arguments into list as sort function is not allowed on arguments
		envelope.env_peaks.forEach(function(...env_peak){
			env_peak.sort(function(x,y){
				return d3.descending(x.intensity, y.intensity);
			})
		})
	})
	envelopeList.sort(function(x,y){
	 	return d3.descending(x.env_peaks[0].intensity, y.env_peaks[0].intensity);
	})
	return envelopeList ;
}

/**
 * 
 * @param {list} listData - contains list of data
 * @param {string} keyValue - contains keyword based on which new group is created
 * Function returns a map list with key and value 
 */
function groupBy(listData,keyValue){
	const map = new Map();
    listData.forEach((element)=>{
        const key = element[keyValue];
        const collection = map.get(key);
        if(!collection) map.set(key,[element]);
        else collection.push(element);
    });
    return map;
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Namespaces</h3><ul><li><a href="-_anonymous_-altEditor.classes.html">classes</a></li><li><a href="-_anonymous_-altEditor.defaults.html">defaults</a></li><li><a href="-_ext.type.html">type</a></li><li><a href="Common%2520and%2520useful%2520DOM%2520elements%2520for%2520the%2520class%2520instance.html">Common and useful DOM elements for the class instance</a></li><li><a href="DataTable.defaults.html">defaults</a></li><li><a href="DataTable.defaults.classes.html">classes</a></li><li><a href="DataTable.defaults.html#.column">column</a></li><li><a href="DataTable.defaults.language.html">language</a></li><li><a href="DataTable.defaults.language.aria.html">aria</a></li><li><a href="DataTable.defaults.language.paginate.html">paginate</a></li><li><a href="DataTable.defaults.search.html">search</a></li><li><a href="DataTable.ext.html">ext</a></li><li><a href="DataTable.models.html">models</a></li><li><a href="DataTable.models.oColumn.html">oColumn</a></li><li><a href="DataTable.models.oRow.html">oRow</a></li><li><a href="DataTable.models.oSearch.html">oSearch</a></li><li><a href="DataTable.models.oSettings.html">oSettings</a></li><li><a href="DataTable.models.oSettings.oBrowser.html">oBrowser</a></li><li><a href="DataTable.models.oSettings.oFeatures.html">oFeatures</a></li><li><a href="DataTable.models.oSettings.oLanguage.html">oLanguage</a></li><li><a href="DataTable.models.oSettings.oPreviousSearch.html">oPreviousSearch</a></li><li><a href="DataTable.models.oSettings.oScroll.html">oScroll</a></li><li><a href="DataTable.render.html">render</a></li><li><a href="DataTable.util.html">util</a></li><li><a href="Settings%2520object%2520which%2520contains%2520customisable%2520information%250A%2520%2520%2520%2520%2520%2520%2520%2520%2520%2520%2520for%2520altEditor%2520instance.html">Settings object which contains customisable information
           for altEditor instance</a></li></ul><h3>Classes</h3><ul><li><a href="CalculateEmassAndDistribution.html">CalculateEmassAndDistribution</a></li><li><a href="Constants.html">Constants</a></li><li><a href="DataTable.Api.html">Api</a></li><li><a href="GetMassTableOfSelectedIons.html">GetMassTableOfSelectedIons</a></li><li><a href="MolecularFormulae.html">MolecularFormulae</a></li><li><a href="SpectrumDownload.html">SpectrumDownload</a></li><li><a href="DataTable_.html">~DataTable</a></li></ul><h3>Events</h3><ul><li><a href="DataTable_column-sizing.html#.event:dt">dt</a></li><li><a href="DataTable_column-visibility.html#.event:dt">dt</a></li><li><a href="DataTable_destroy.html#.event:dt">dt</a></li><li><a href="DataTable_draw.html#.event:dt">dt</a></li><li><a href="DataTable_init.html#.event:dt">dt</a></li><li><a href="DataTable_length.html#.event:dt">dt</a></li><li><a href="DataTable_order.html#.event:dt">dt</a></li><li><a href="DataTable_page.html#.event:dt">dt</a></li><li><a href="DataTable_processing.html#.event:dt">dt</a></li><li><a href="DataTable_search.html#.event:dt">dt</a></li><li><a href="DataTable_stateLoaded.html#.event:dt">dt</a></li><li><a href="DataTable_stateLoadParams.html#.event:dt">dt</a></li><li><a href="DataTable_stateSaveParams.html#.event:dt">dt</a></li><li><a href="DataTable_xhr.html#.event:dt">dt</a></li></ul><h3>Global</h3><ul><li><a href="global.html#$">$</a></li><li><a href="global.html#_">_</a></li><li><a href="global.html#_addRowCallback">_addRowCallback</a></li><li><a href="global.html#_addRowData">_addRowData</a></li><li><a href="global.html#_deleteRow">_deleteRow</a></li><li><a href="global.html#_deleteRowCallback">_deleteRowCallback</a></li><li><a href="global.html#_editRowCallback">_editRowCallback</a></li><li><a href="global.html#_editRowData">_editRowData</a></li><li><a href="global.html#_errorCallback">_errorCallback</a></li><li><a href="global.html#addBackGround">addBackGround</a></li><li><a href="global.html#addCircles">addCircles</a></li><li><a href="global.html#addDatatoAxis">addDatatoAxis</a></li><li><a href="global.html#addLabels">addLabels</a></li><li><a href="global.html#addSpectrum">addSpectrum</a></li><li><a href="global.html#api">api</a></li><li><a href="global.html#calibrateCoordinates">calibrateCoordinates</a></li><li><a href="global.html#calibrateLeftNum">calibrateLeftNum</a></li><li><a href="global.html#calibrateRightNum">calibrateRightNum</a></li><li><a href="global.html#calibrateSkipEnd">calibrateSkipEnd</a></li><li><a href="global.html#calibrateSkipStart">calibrateSkipStart</a></li><li><a href="global.html#checkWaitTasks">checkWaitTasks</a></li><li><a href="global.html#completeColumnDefs">completeColumnDefs</a></li><li><a href="global.html#createDialog">createDialog</a></li><li><a href="global.html#drag">drag</a></li><li><a href="global.html#drawAxis">drawAxis</a></li><li><a href="global.html#drawIons">drawIons</a></li><li><a href="global.html#drawPeaks">drawPeaks</a></li><li><a href="global.html#drawSequence">drawSequence</a></li><li><a href="global.html#drawSpectrum">drawSpectrum</a></li><li><a href="global.html#drawTicks">drawTicks</a></li><li><a href="global.html">Edit a row</a></li><li><a href="global.html#fnAddData">fnAddData</a></li><li><a href="global.html#fnAdjustColumnSizing">fnAdjustColumnSizing</a></li><li><a href="global.html#fnClearTable">fnClearTable</a></li><li><a href="global.html#fnClose">fnClose</a></li><li><a href="global.html#fnDeleteRow">fnDeleteRow</a></li><li><a href="global.html#fnDestroy">fnDestroy</a></li><li><a href="global.html#fnDraw">fnDraw</a></li><li><a href="global.html#fnFilter">fnFilter</a></li><li><a href="global.html#fnGetData">fnGetData</a></li><li><a href="global.html#fnGetNodes">fnGetNodes</a></li><li><a href="global.html#fnGetPosition">fnGetPosition</a></li><li><a href="global.html#fnIsOpen">fnIsOpen</a></li><li><a href="global.html#fnOpen">fnOpen</a></li><li><a href="global.html#fnPageChange">fnPageChange</a></li><li><a href="global.html#fnSetColumnVis">fnSetColumnVis</a></li><li><a href="global.html#fnSettings">fnSettings</a></li><li><a href="global.html#fnSort">fnSort</a></li><li><a href="global.html#fnSortListener">fnSortListener</a></li><li><a href="global.html#fnUpdate">fnUpdate</a></li><li><a href="global.html#fnVersionCheck">fnVersionCheck</a></li><li><a href="global.html#getAminoAcidDistribution">getAminoAcidDistribution</a></li><li><a href="global.html#getCircleSize">getCircleSize</a></li><li><a href="global.html#getEnvelopeData">getEnvelopeData</a></li><li><a href="global.html#getIonData">getIonData</a></li><li><a href="global.html#getIsotopicMassOfAtom">getIsotopicMassOfAtom</a></li><li><a href="global.html#getIsotopicMassRef">getIsotopicMassRef</a></li><li><a href="global.html#getNormalizedIntensity">getNormalizedIntensity</a></li><li><a href="global.html#getPeakXPos">getPeakXPos</a></li><li><a href="global.html#getPeakYPos">getPeakYPos</a></li><li><a href="global.html#getTickHeight">getTickHeight</a></li><li><a href="global.html#getTickWidth">getTickWidth</a></li><li><a href="global.html#getY">getY</a></li><li><a href="global.html#groupBy">groupBy</a></li><li><a href="global.html#initScale">initScale</a></li><li><a href="global.html#job">job</a></li><li><a href="global.html#onAddRow">onAddRow</a></li><li><a href="global.html#onCircleMouseOut">onCircleMouseOut</a></li><li><a href="global.html#onclickTopView">onclickTopView</a></li><li><a href="global.html#onDeleteRow">onDeleteRow</a></li><li><a href="global.html#onDragLimits">onDragLimits</a></li><li><a href="global.html#onEditRow">onEditRow</a></li><li><a href="global.html#onMouseOut">onMouseOut</a></li><li><a href="global.html#onMouseOverCircle">onMouseOverCircle</a></li><li><a href="global.html#onMouseOverPeak">onMouseOverPeak</a></li><li><a href="global.html#onPeakMouseOut">onPeakMouseOut</a></li><li><a href="global.html#parameters">parameters</a></li><li><a href="global.html#reloadOptions">reloadOptions</a></li><li><a href="global.html#setLimits">setLimits</a></li><li><a href="global.html#showAllPeaks">showAllPeaks</a></li><li><a href="global.html#showIonPeaks">showIonPeaks</a></li><li><a href="global.html#showMatchedPeaks">showMatchedPeaks</a></li><li><a href="global.html#showNonMatchedPeaks">showNonMatchedPeaks</a></li><li><a href="global.html#showNotMatchedPeaks">showNotMatchedPeaks</a></li><li><a href="global.html#sortEnvelopes">sortEnvelopes</a></li><li><a href="global.html#SpectrumGraph">SpectrumGraph</a></li><li><a href="global.html#svgIds">svgIds</a></li><li><a href="global.html#updateSeq">updateSeq</a></li><li><a href="global.html#xZoom">xZoom</a></li><li><a href="global.html#yZoom">yZoom</a></li><li><a href="global.html#zoom">zoom</a></li><li><a href="global.html#%257BonClickSequenceOfExecution%257Dexecuteswhenuserentersmassshiftonanyaminoacidandclick%2522OK%2522button.">{onClickSequenceOfExecution} executes when user enters mass shift 
on any amino acid and click "OK" button.</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.4</a> on Thu Apr 16 2020 16:10:17 GMT-0400 (Eastern Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
